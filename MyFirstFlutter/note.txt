å¤ªå¥½äº†ï¼æˆ‘å¹«ä½ è¨­è¨ˆä¸€å€‹ ã€Œåæ‡‰åŠ›å°éŠæˆ² (Reaction Trainer)ã€ï¼Œç”¨ä¾†ç·´ç¿’ Flutter/Dart çš„éŠæˆ²é–‹ç™¼ï¼ŒåŒæ™‚å°å…¥ MVVM æ¶æ§‹èˆ‡å¸¸è¦‹è¨­è¨ˆæ¨¡å¼ï¼ˆRepositoryã€Strategyã€Observer via ChangeNotifierï¼‰ã€‚
UI æœƒåŒ…å« æŒ‰éˆ•ï¼ˆStart/Tapï¼‰ã€ListViewï¼ˆå›åˆåˆ—è¡¨èˆ‡åˆ†æ•¸ï¼‰ã€Toastï¼ˆç”¨ SnackBarï¼‰ã€ä»¥åŠ Dialogï¼ˆæ¸…é™¤æ­·å²ã€çµæŸå›åˆæé†’ï¼‰ã€‚

ğŸ® éŠæˆ²æ¦‚å¿µï¼šReaction Trainer

ç©å®¶æŒ‰ä¸‹ã€ŒStart Roundã€å¾Œï¼Œç³»çµ±æœƒåœ¨ éš¨æ©Ÿå»¶é²ï¼ˆ800â€“1800msï¼‰å¾Œé¡¯ç¤ºã€ŒTap Now!ã€ã€‚
ç©å®¶åœ¨æç¤ºå‡ºç¾å¾ŒæŒ‰ä¸‹ã€ŒTapã€ï¼š

å¤ªæ—©æŒ‰ï¼ˆæç¤ºå‰ï¼‰ï¼šEarly
æŒ‰å¾—å¿«ï¼šSuccessï¼ˆåæ‡‰æ™‚é–“è¶ŠçŸ­ï¼Œåˆ†æ•¸è¶Šé«˜ï¼‰
å¤ªæ…¢ï¼šLateï¼ˆè¶…éé–€æª»ï¼Œä½åˆ†æˆ– 0 åˆ†ï¼‰


æ¯å€‹å›åˆæœƒè¨˜éŒ„ åæ‡‰æ™‚é–“èˆ‡åˆ†æ•¸ï¼Œé¡¯ç¤ºåœ¨ ListViewã€‚
å®Œæˆå›åˆæœƒé¡¯ç¤º Toastï¼ˆSnackBarï¼‰ï¼Œæ¸…é™¤æ­·å²æœƒç”¨ Dialogã€‚


ğŸ§± æ¶æ§‹èˆ‡è¨­è¨ˆæ¨¡å¼
MVVM åˆ†å±¤

Modelï¼šRoundï¼ˆå›åˆè³‡æ–™ã€åæ‡‰æ™‚é–“ã€çµæœã€åˆ†æ•¸ï¼‰
ViewModelï¼šGameViewModelï¼ˆç‹€æ…‹æ©Ÿã€éš¨æ©Ÿå»¶é²ã€åˆ†æ•¸è¨ˆç®—ã€é€šçŸ¥ UIï¼‰
Viewï¼šGamePageï¼ˆæŒ‰éˆ•ã€ListViewã€Toastã€Dialogï¼‰

è¨­è¨ˆæ¨¡å¼

Observerï¼ˆChangeNotifierï¼‰ï¼šViewModel â†’ View æ›´æ–°
Strategyï¼šScoreStrategy æ±ºå®šåˆ†æ•¸æ¼”ç®—æ³•ï¼ˆå¯æ›¿æ›ï¼‰
Repositoryï¼šScoreRepository æŠ½è±¡å„²å­˜ï¼ˆå…ˆç”¨è¨˜æ†¶é«”ï¼Œæœªä¾†å¯æ› Hive/SQLiteï¼‰


ğŸ“ å°ˆæ¡ˆçµæ§‹ï¼ˆç¯„ä¾‹ï¼‰
lib/
  main.dart
  models/
    round.dart
  services/
    scoring.dart
  repositories/
    score_repository.dart
  viewmodels/
    game_view_model.dart
  views/
    game_page.dart
  widgets/
    round_tile.dart


ğŸ“¦ ç›¸ä¾å¥—ä»¶ï¼ˆpubspec.yamlï¼‰
YAMLname: reaction_trainerdescription: A small Flutter MVVM game with button, list view, toast, and dialog.environment:  sdk: ">=3.3.0 <4.0.0"dependencies:  flutter:    sdk: flutter  provider: ^6.1.2dev_dependencies:  flutter_test:    sdk: flutteré¡¯ç¤ºæ›´å¤šè¡Œ

Toast æˆ‘å€‘ç”¨ Flutter çš„ ScaffoldMessenger é¡ä¼¼ Toast çš„æç¤ºï¼ˆä¸éœ€å¤–æ›ï¼‰ã€‚è‹¥ä½ æƒ³ç”¨åŸç”Ÿ Toast UIï¼Œå¯ä»¥æ”¹ç”¨ fluttertoast å¥—ä»¶ã€‚


ğŸ§© Modelï¼šRound
Dart// lib/models/round.dartenum RoundResult { early, success, late }class Round {  final int id;  final DateTime startAt;  final DateTime? promptAt;  final DateTime? tapAt;  final int? reactionMs; // å¾ prompt åˆ° tap çš„æ¯«ç§’æ•¸  final RoundResult? result;  final int score;  const Round({    required this.id,    required this.startAt,    this.promptAt,    this.tapAt,    this.reactionMs,    this.result,    this.score = 0,  });  Round copyWith({    DateTime? promptAt,    DateTime? tapAt,    int? reactionMs,    RoundResult? result,    int? score,  }) {    return Round(      id: id,      startAt: startAt,      promptAt: promptAt ?? this.promptAt,      tapAt: tapAt ?? this.tapAt,      reactionMs: reactionMs ?? this.reactionMs,      result: result ?? this.result,      score: score ?? this.score,    );  }  @override  String toString() =>      'Round#$id result=$result reaction=${reactionMs ?? '-'}ms score=$score';}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸ§® Strategyï¼šåˆ†æ•¸ç­–ç•¥
Dart// lib/services/scoring.dartimport '../models/round.dart';abstract class ScoreStrategy {  int scoreFor(Round r);}/// åŸºæœ¬ç­–ç•¥ï¼š/// - Early: 0 åˆ†/// - Success: åˆ†æ•¸ = max(10, 400 - reactionMs)ï¼Œè¶Šå¿«åˆ†è¶Šé«˜/// - Late: 10 åˆ†ï¼ˆæˆ–ä½ æƒ³èª¿æ•´ï¼‰class NormalScoreStrategy implements ScoreStrategy {  static const int maxBase = 400;  @override  int scoreFor(Round r) {    if (r.result == RoundResult.early) return 0;    if (r.result == RoundResult.success) {      final ms = r.reactionMs ?? maxBase;      final s = (maxBase - ms).clamp(10, maxBase);      return s;    }    return 10; // late  }}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸ’¾ Repositoryï¼šåˆ†æ•¸å„²å­˜ï¼ˆå¯æ›¿æ›ï¼‰
Dart// lib/repositories/score_repository.dartimport '../models/round.dart';abstract class ScoreRepository {  Future<void> save(Round r);  Future<List<Round>> list();  Future<void> clear();}class InMemoryScoreRepository implements ScoreRepository {  final List<Round> _data = [];  @override  Future<void> save(Round r) async {    _data.add(r);  }  @override  Future<List<Round>> list() async => List.unmodifiable(_data);  @override  Future<void> clear() async => _data.clear();}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸ§  ViewModelï¼šç‹€æ…‹æ©Ÿ + é‚è¼¯
Dart// lib/viewmodels/game_view_model.dartimport 'dart:async';import 'dart:math';import 'package:flutter/foundation.dart';import '../models/round.dart';import '../repositories/score_repository.dart';import '../services/scoring.dart';enum GamePhase { idle, waiting, prompted, finished }class GameViewModel extends ChangeNotifier {  final ScoreRepository repo;  final ScoreStrategy strategy;  final Random _random = Random();  List<Round> _history = [];  List<Round> get history => _history;  GamePhase _phase = GamePhase.idle;  GamePhase get phase => _phase;  Round? _current;  Round? get current => _current;  int _nextId = 1;  Timer? _timer;  // æä¾› UI é¡¯ç¤ºè¨Šæ¯ï¼ˆToast ç”¨ï¼‰  String? _lastToast;  String? takeLastToast() {    final msg = _lastToast;    _lastToast = null;    return msg;  }  GameViewModel({required this.repo, required this.strategy}) {    _loadHistory();  }  Future<void> _loadHistory() async {    _history = await repo.list();    notifyListeners();  }  String get buttonLabel {    switch (_phase) {      case GamePhase.idle:      case GamePhase.finished:        return 'Start Round';      case GamePhase.waiting:        return 'Wait...';      case GamePhase.prompted:        return 'Tap!';    }  }  bool get canTap => _phase == GamePhase.prompted || _phase == GamePhase.waiting;  Future<void> startRound() async {    _cancelTimer();    _current = Round(id: _nextId++, startAt: DateTime.now());    _phase = GamePhase.waiting;    notifyListeners();    final delayMs = 800 + _random.nextInt(1000); // 800â€“1800ms    _timer = Timer(Duration(milliseconds: delayMs), () {      _current = _current?.copyWith(promptAt: DateTime.now());      _phase = GamePhase.prompted;      notifyListeners();    });  }  Future<void> onTap() async {    final now = DateTime.now();    if (_phase == GamePhase.waiting) {      // æç¤ºå‰å°±æŒ‰      _current = _current?.copyWith(        tapAt: now,        result: RoundResult.early,        reactionMs: 0,      );      await _finishRound();      return;    }    if (_phase == GamePhase.prompted) {      final ms = now.difference(_current!.promptAt!).inMilliseconds;      final result = ms <= 400 ? RoundResult.success : RoundResult.late;      _current = _current?.copyWith(        tapAt: now,        reactionMs: ms,        result: result,      );      await _finishRound();    }  }  Future<void> _finishRound() async {    _cancelTimer();    final computedScore = strategy.scoreFor(_current!);    _current = _current!.copyWith(score: computedScore);    _phase = GamePhase.finished;    await repo.save(_current!);    _history = await repo.list();    _lastToast = switch (_current!.result) {      RoundResult.early => 'Too early! +0',      RoundResult.success => 'Great! ${_current!.reactionMs}ms, +${_current!.score}',      RoundResult.late => 'Late: ${_current!.reactionMs}ms, +${_current!.score}',      _ => 'Round finished',    };    notifyListeners();  }  Future<void> clearHistory() async {    await repo.clear();    _history = [];    notifyListeners();  }  void _cancelTimer() {    _timer?.cancel();    _timer = null;  }  @override  void dispose() {    _cancelTimer();    super.dispose();  }}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸ–¼ï¸ Viewï¼ˆå«æŒ‰éˆ•ã€ListViewã€Toastã€Dialogï¼‰
Dart// lib/views/game_page.dartimport 'package:flutter/material.dart';import 'package:provider/provider.dart';import '../viewmodels/game_view_model.dart';import '../widgets/round_tile.dart';class GamePage extends StatelessWidget {  const GamePage({super.key});  @override  Widget build(BuildContext context) {    return Consumer<GameViewModel>(      builder: (context, vm, _) {        // Toastï¼šé€é post-frame æª¢æŸ¥æœ‰æ²’æœ‰æ–°è¨Šæ¯        WidgetsBinding.instance.addPostFrameCallback((_) {          final msg = vm.takeLastToast();          if (msg != null) {            ScaffoldMessenger.of(context).showSnackBar(              SnackBar(content: Text(msg), duration: const Duration(seconds: 2)),            );          }        });        return Scaffold(          appBar: AppBar(            title: const Text('Reaction Trainer'),            actions: [              IconButton(                icon: const Icon(Icons.delete),                tooltip: 'æ¸…é™¤æ­·å²',                onPressed: () async {                  final confirm = await showDialog<bool>(                    context: context,                    builder: (ctx) => AlertDialog(                      title: const Text('æ¸…é™¤è¨˜éŒ„'),                      content: const Text('ç¢ºå®šè¦åˆªé™¤å…¨éƒ¨å›åˆè¨˜éŒ„å—ï¼Ÿ'),                      actions: [                        TextButton(onPressed: () => Navigator.pop(ctx, false), child: const Text('å–æ¶ˆ')),                        ElevatedButton(onPressed: () => Navigator.pop(ctx, true), child: const Text('ç¢ºå®š')),                      ],                    ),                  );                  if (confirm == true) {                    await vm.clearHistory();                    ScaffoldMessenger.of(context).showSnackBar(                      const SnackBar(content: Text('å·²æ¸…é™¤'), duration: Duration(seconds: 1)),                    );                  }                },              ),            ],          ),          body: Column(            children: [              const SizedBox(height: 24),              Center(                child: ElevatedButton(                  onPressed: () {                    switch (vm.phase) {                      case GamePhase.idle:                      case GamePhase.finished:                        vm.startRound();                        break;                      case GamePhase.waiting:                      case GamePhase.prompted:                        vm.onTap();                        break;                    }                  },                  child: Text(vm.buttonLabel),                ),              ),              const SizedBox(height: 12),              Text(                _phaseText(vm.phase),                style: const TextStyle(fontSize: 16, color: Colors.grey),              ),              const Divider(height: 24),              Expanded(                child: ListView.separated(                  itemCount: vm.history.length,                  separatorBuilder: (_, __) => const Divider(height: 1),                  itemBuilder: (context, index) {                    final round = vm.history.reversed.toList()[index]; // æœ€æ–°åœ¨ä¸Š                    return RoundTile(round: round);                  },                ),              ),            ],          ),        );      },    );  }  String _phaseText(GamePhase phase) {    return switch (phase) {      GamePhase.idle => 'æŒ‰ä¸‹ Start Round é–‹å§‹',      GamePhase.waiting => 'ç­‰å¾…æç¤ºä¸­â€¦',      GamePhase.prompted => 'å¿«æŒ‰ Tapï¼',      GamePhase.finished => 'å›åˆçµæŸ',    };  }}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸ”¹ List Item Widget
Dart// lib/widgets/round_tile.dartimport 'package:flutter/material.dart';import '../models/round.dart';class RoundTile extends StatelessWidget {  final Round round;  const RoundTile({super.key, required this.round});  Color _resultColor(RoundResult? r) {    return switch (r) {      RoundResult.success => Colors.green,      RoundResult.late => Colors.orange,      RoundResult.early => Colors.red,      _ => Colors.grey,    };  }  @override  Widget build(BuildContext context) {    final reactionText = (round.reactionMs != null) ? '${round.reactionMs} ms' : '-';    final resultText = switch (round.result) {      RoundResult.success => 'Success',      RoundResult.late => 'Late',      RoundResult.early => 'Early',      _ => 'N/A'    };    return ListTile(      leading: CircleAvatar(child: Text('${round.id}')),      title: Text('Result: $resultText', style: TextStyle(color: _resultColor(round.result))),      subtitle: Text('Reaction: $reactionText'),      trailing: Text('Score: ${round.score}', style: const TextStyle(fontWeight: FontWeight.bold)),    );  }}é¡¯ç¤ºæ›´å¤šè¡Œ

ğŸš€ Mainï¼šå•Ÿå‹•èˆ‡ä¾è³´æ³¨å…¥ï¼ˆDIï¼‰
Dart// lib/main.dartimport 'package:flutter/material.dart';import 'package:provider/provider.dart';import 'repositories/score_repository.dart';import 'services/scoring.dart';import 'viewmodels/game_view_model.dart';import 'views/game_page.dart';void main() {  runApp(const ReactionApp());}class ReactionApp extends StatelessWidget {  const ReactionApp({super.key});  @override  Widget build(BuildContext context) {    return MultiProvider(      providers: [        Provider<ScoreRepository>(create: (_) => InMemoryScoreRepository()),        Provider<ScoreStrategy>(create: (_) => NormalScoreStrategy()),        ChangeNotifierProvider<GameViewModel>(          create: (ctx) => GameViewModel(            repo: ctx.read<ScoreRepository>(),            strategy: ctx.read<ScoreStrategy>(),          ),        ),      ],      child: MaterialApp(        title: 'Reaction Trainer',        theme: ThemeData(useMaterial3: true, colorSchemeSeed: Colors.blue),        home: const GamePage(),      ),    );  }}é¡¯ç¤ºæ›´å¤šè¡Œ

âœ… ä½ æœƒç·´åˆ°çš„é‡é»

MVVMï¼šViewModel æŒæœ‰ä¸å¯è®Š Round æ¨¡å‹èˆ‡éŠæˆ²ç‹€æ…‹ï¼ŒView åªè² è²¬å±•ç¤ºèˆ‡è§¸ç™¼äº‹ä»¶ã€‚
Observerï¼šChangeNotifier + Providerï¼ŒUI éš¨ç‹€æ…‹æ›´æ–°ã€‚
Strategyï¼šåˆ†æ•¸ç­–ç•¥å¯æ›¿æ›ï¼Œä¾‹å¦‚åŠ ä¸Šã€Œé€£çºŒæˆåŠŸåŠ æˆã€ã€ã€Œé›£åº¦ç­‰ç´šã€ã€‚
Repositoryï¼šè³‡æ–™å±¤æŠ½è±¡ï¼Œä¹‹å¾Œå¯ç„¡ç—›æ› Hive/SQLiteã€‚
Toast & Dialogï¼šSnackBar ä½œç‚º Toastï¼ŒshowDialog åšæ¸…é™¤ç¢ºèªï¼ä¹Ÿå¯åœ¨çµæŸå›åˆæé†’ã€‚


ğŸ§ª å»¶ä¼¸èˆ‡æŒ‘æˆ°

æŒä¹…åŒ–ï¼šæŠŠ InMemoryScoreRepository æ”¹ç‚º Hive æˆ– shared_preferencesã€‚
é›£åº¦ï¼šå¼•å…¥ Difficultyï¼ˆEasy/Normal/Hardï¼‰ï¼Œä½¿ç”¨ Strategy èª¿æ•´åˆ†æ•¸èˆ‡ç­‰å¾…ç¯„åœã€‚
æ’è¡Œæ¦œï¼šä»¥æ—¥æœŸåˆ†çµ„ã€æœ€é«˜åˆ†æ’åºï¼Œç·´ç¿’ ListView çš„ ListView.separatedã€SliverListã€‚
ç‹€æ…‹ç®¡ç†å‡ç´šï¼šå°‡ GamePhase ä¹Ÿåšæˆä¸å¯è®Š GameStateï¼Œç”¨ copyWith ç”¢ç”Ÿæ–°ç‹€æ…‹ï¼ˆåƒä½ åœ¨ Android MVVM çš„åšæ³•ï¼‰ã€‚
æ¸¬è©¦ï¼šç‚º GameViewModel å¯«å–®å…ƒæ¸¬è©¦ï¼ˆæ¨¡æ“¬ Timer å¯ç”¨ FakeAsyncï¼‰ã€‚


æƒ³å®¢è£½åŒ–æ›´æ¥è¿‘ä½ çš„å ´æ™¯ï¼Ÿ
ä½ ä¹‹å‰æœ‰åš Android MVVM éŠæˆ²èˆ‡æ’è¡Œæ¦œï¼Œæˆ‘å¯ä»¥å¹«ä½ æŠŠé€™å€‹ç¯„ä¾‹æ”¹æˆï¼š

è³½è»Šèµ·æ­¥åæ‡‰ï¼ˆStart light â†’ Tap to launchï¼‰
BLE æˆ–ç¶²è·¯å»¶é²æ¸¬è©¦ï¼ˆæ¨¡æ“¬æ”¶åˆ°è¨Šè™Ÿå¾Œåæ‡‰æ™‚é–“ï¼‰
æ’è¡Œæ¦œè½åœ°ï¼ˆRoom âœ Hive/SQLiteï¼‰ çš„è³‡æ–™é·ç§»

ä½ å¸Œæœ›ä¸‹ä¸€æ­¥åŠ ä¸Š æŒä¹…åŒ– é‚„æ˜¯ é›£åº¦èˆ‡åŠ æˆç­–ç•¥ï¼Ÿæˆ‘å¯ä»¥ç›´æ¥å¹«ä½ æ“´å……å°æ‡‰çš„ Repository/Strategy èˆ‡ UIã€‚